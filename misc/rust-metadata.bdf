// BinDef for the header of a rustc binary metadata file

// This format is undocumented and so the structure has been obtained from
// source code files.
// https://doc.rust-lang.org/nightly/nightly-rustc/src/rustc_metadata/rmeta/mod.rs.html

{
  meta: {
    bdf: "0.5",
    name: "rustc crate metadata archive",
    mime: [],
    exts: [".rmeta"]
  },
  binary: [
    { type: byte[7], magic: _ == "rust\x00\x00\x00" },
    { id: version, type: uint8 },
    { id: rootPos, type: uint64, endian: "little" },

    { type: uint16,               id: targetTupleLen, endian: "big", at: rootPos },
    { type: byte[targetTupleLen], id: targetTuple,    endian: "big" },
  ]
}